<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biskaken Auto Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- Main Container -->
    <div class="min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="flex-shrink-0">
                            <h1 class="text-xl font-bold text-gray-900">üîß Biskaken Auto</h1>
                        </div>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center">
                                <span class="text-blue-700 font-semibold text-sm">{{ user.name[0] if user and user.name else 'A' }}</span>
                            </div>
                            <div class="text-sm">
                                <p class="text-gray-900 font-medium">{{ user.name if user and user.name else 'Admin User' }}</p>
                                <p class="text-gray-500">{{ user.role if user and user.role else 'ADMIN' }}</p>
                            </div>
                        </div>
                        <a href="/logout" class="text-red-600 hover:text-red-700 text-sm">
                            Sign Out
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <div class="px-4 py-6 sm:px-0">
                <!-- Welcome Section -->
                <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-4 mb-6">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">
                            Welcome back, {{ user.name if user and user.name else 'Admin' }}!
                        </h1>
                        <p class="text-gray-500">Here's what's happening at your auto shop today.</p>
                    </div>
                    
                    <!-- Quick Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3">
                        <button onclick="window.location.href='/'" 
                                class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 flex items-center gap-2 transition-colors">
                            üè† Go to Homepage
                        </button>
                        <button onclick="window.location.href='/jobs'" 
                                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 transition-colors">
                            ‚ûï New Work Order
                        </button>
                        <button onclick="refreshData()" 
                                class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center gap-2 transition-colors">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border hover:shadow-md transition-shadow">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Total Revenue</p>
                                <h3 class="text-2xl font-bold mt-1 text-gray-900">‚Çµ{{ stats.revenue if stats else '15,750.00' }}</h3>
                                <p class="text-xs mt-1 font-medium text-emerald-600">
                                    +12.5% <span class="text-gray-400 ml-1">from last month</span>
                                </p>
                            </div>
                            <div class="p-3 rounded-xl bg-emerald-500 bg-opacity-10 text-emerald-600">
                                üìà
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border hover:shadow-md transition-shadow">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Active Jobs</p>
                                <h3 class="text-2xl font-bold mt-1 text-gray-900">{{ stats.active_jobs if stats else '5' }}</h3>
                                <p class="text-xs mt-1 font-medium text-blue-600">
                                    +8.2% <span class="text-gray-400 ml-1">from last month</span>
                                </p>
                            </div>
                            <div class="p-3 rounded-xl bg-blue-500 bg-opacity-10 text-blue-600">
                                üöó
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border hover:shadow-md transition-shadow">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Completed Jobs</p>
                                <h3 class="text-2xl font-bold mt-1 text-gray-900">{{ stats.completed_jobs if stats else '28' }}</h3>
                                <p class="text-xs mt-1 font-medium text-green-600">
                                    +15.3% <span class="text-gray-400 ml-1">from last month</span>
                                </p>
                            </div>
                            <div class="p-3 rounded-xl bg-green-500 bg-opacity-10 text-green-600">
                                ‚úÖ
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm border hover:shadow-md transition-shadow">
                        <div class="flex justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Total Customers</p>
                                <h3 class="text-2xl font-bold mt-1 text-gray-900">{{ stats.total_customers if stats else '156' }}</h3>
                                <p class="text-xs mt-1 font-medium text-purple-600">
                                    +5.7% <span class="text-gray-400 ml-1">from last month</span>
                                </p>
                            </div>
                            <div class="p-3 rounded-xl bg-purple-500 bg-opacity-10 text-purple-600">
                                üë•
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts and Activities -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Revenue Chart -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Weekly Revenue</h3>
                        <div class="h-64">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>

                    <!-- Recent Activities -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Recent Work Orders</h3>
                            <span class="text-sm text-gray-500">{{ recent_jobs|length if recent_jobs else '3' }} active</span>
                        </div>
                        <div class="space-y-3">
                            {% if recent_jobs %}
                                {% for job in recent_jobs %}
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <div class="w-3 h-3 rounded-full bg-blue-500"></div>
                                        <div>
                                            <p class="font-medium text-gray-900">{{ job.customer_name or 'Customer' }}</p>
                                            <p class="text-sm text-gray-500">{{ job.description or 'Service' }}</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            {{ job.status or 'Active' }}
                                        </span>
                                        <p class="text-sm text-gray-500 mt-1">‚Çµ{{ job.estimated_cost or '450' }}</p>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                            <div class="text-center py-8 text-gray-500">
                                üöó
                                <p class="mt-2">No recent work orders</p>
                                <button onclick="window.location.href='/jobs'" 
                                        class="text-blue-600 hover:text-blue-700 text-sm mt-1">
                                    Create your first job
                                </button>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- System Status -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- System Health -->
                    <div class="bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">System Status</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Database</span>
                                <span class="flex items-center text-green-600">
                                    ‚úÖ Connected
                                </span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">API Services</span>
                                <span class="flex items-center text-green-600">
                                    ‚úÖ Active
                                </span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-600">Mobile Money</span>
                                <span class="flex items-center text-yellow-600">
                                    üïí Testing
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Mobile Money Test -->
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üí∞ Mobile Money Test</h3>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <p class="font-medium text-yellow-800 mb-2">üîß Payment System Ready</p>
                                <p class="text-sm text-yellow-700">Ghana Mobile Money integration configured</p>
                            </div>
                            <div class="space-y-2">
                                <button onclick="testMTN()" 
                                        class="w-full bg-yellow-500 text-white py-2 px-4 rounded-lg hover:bg-yellow-600 transition-colors text-sm font-medium">
                                    Test MTN MoMo
                                </button>
                                <button onclick="testVodafone()" 
                                        class="w-full bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                                    Test Vodafone Cash
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Simple AI Insights -->
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-xl border mt-6">
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="p-2 bg-purple-100 rounded-lg">
                            ‚ú®
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">AI Business Insights</h3>
                            <p class="text-sm text-gray-600">Powered by advanced analytics</p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="text-center p-3 bg-blue-50 rounded-lg">
                                <p class="text-sm text-blue-900">üìä Peak Hours: 2-4 PM shows highest customer traffic</p>
                            </div>
                            <div class="text-center p-3 bg-green-50 rounded-lg">
                                <p class="text-sm text-green-900">üí° Upselling: Offer tire rotation with oil changes</p>
                            </div>
                            <div class="text-center p-3 bg-purple-50 rounded-lg">
                                <p class="text-sm text-purple-900">üéØ Retention: 85% customer satisfaction rate</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Simple Revenue Chart
        const ctx = document.getElementById('revenueChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: 'Revenue',
                    data: [1200, 1900, 1500, 2400, 1800, 3200, 900],
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '‚Çµ' + value;
                            }
                        }
                    }
                }
            }
        });

        // Simple functions
        function refreshData() {
            console.log('Refreshing data...');
            window.location.reload();
        }

        function testMTN() {
            alert('MTN Mobile Money test initiated');
        }

        function testVodafone() {
            alert('Vodafone Cash test initiated');
        }
    </script>
</body>
</html>