# Biskaken Auto Shop Management - Nixpacks Configuration
# Dokploy deployment with Node.js 18 and PostgreSQL support

[variables]
NODE_ENV = "production"
PORT = "5000"

[phases.setup]
nixPkgs = ["nodejs_18", "postgresql"]

[phases.install]
cmds = [
    "npm ci --include=dev",
    "cd biskaken-auto-api && npm ci --include=dev"
]
cacheDirectories = ["node_modules", "biskaken-auto-api/node_modules"]

[phases.build]
cmds = [
    "npm run build:frontend",
    "npm run build:backend", 
    "npm run build:copy"
]
cacheDirectories = ["dist", "biskaken-auto-api/dist"]

[start]
cmd = "cd biskaken-auto-api && npm start"