# Static Frontend Deployment for Biskaken Auto Landing Page + Blog
[variables]
NODE_ENV = "production"
NODE_VERSION = "20"
PORT = "80"

[phases.setup]
nixPkgs = ["nodejs_20", "caddy"]

[phases.install]
cmds = [
    "echo 'ğŸ“¦ Installing frontend dependencies...'",
    "npm install",
    "echo 'ğŸ”§ Installing Rollup native dependencies for Linux...'",
    "npm install @rollup/rollup-linux-x64-gnu --save-optional"
]

[phases.build]
cmds = [
    "echo 'ğŸ—ï¸ Building static frontend...'",
    "npm run build:frontend",
    "echo 'ğŸ“ Verifying dist directory...'",
    "ls -la dist/"
]

[start]
cmd = "echo 'ğŸš€ Starting Caddy web server on port 80...' && caddy run --config /app/Caddyfile --adapter caddyfile"